## Part 1. Установка ОС

Устанавливаем VirtualBox и скачиваем Ubuntu 20.04 Server LTS с официального сайта. В VirtualBox создаем новую виртуальную машину, выделяем место на диске и ставим ОС.

Посмотреть версию системы можно в файле /etc/issue.

![](pics/01.1.png)

---

## Part 2. Создание пользователя

useradd - команда создания нового пользователя. В ней добавляем его в группу adm.

![](pics/02.1.png)

/etc/passwd — файл, содержащий в текстовом формате список пользовательских учётных записей. Новый пользователь был занесен в список.

![](pics/02.2.png)

---
## Part 3. Настройка сети ОС

1) Меняем название машины через файл /etc/hostname на user-1.

    ![](pics/03.1.png)

2) Затем с помощью команды sudo dpkg-reconfigure tzdata устанавливаем часовой пояс. Проверить успешность настройки можно командой cat /etc/timezone или посмотреть дату и время с помощью команды date.

    ![](pics/03.2.png)

3) Далее мы будем работать с командой ip. Чтобы увидеть названия сетевых интерфейсов воспольнуемся командой ip link:

    ![](pics/03.3.png)

    > lo (loopback device) – виртуальный интерфейс, присутствующий по умолчанию в любом Linux. Он используется для отладки сетевых программ и запуска серверных приложений на локальной машине. С этим интерфейсом всегда связан адрес 127.0.0.1. У него есть dns-имя – localhost. Посмотреть привязку можно в файле /etc/hosts.

    ![](pics/03.4.png)

4) ip адрес устройства можно узнать с помощью команды ip address.

    ![](pics/03.5.png)

    > DHCP (англ. Dynamic Host Configuration Protocol — протокол динамической настройки узла) — прикладной протокол, позволяющий сетевым устройствам автоматически получать IP-адрес и другие параметры, необходимые для работы в сети TCP/IP. Данный протокол работает по модели «клиент-сервер». Сетевой администратор может задать диапазон адресов, распределяемых сервером среди компьютеров. Протокол DHCP используется в большинстве сетей TCP/IP.

5) ip адрес по умолчанию (внутренний IP-адрес шлюза) узнаем из команды ip route:

    ![](pics/03.6.png)

    Узнать внешний ip адрес можно только с помощью стороннего веб-сайта. Воспользуемся curl - командой для получения HTML кода указанной страницы. Сайт curlmyip.ru представляет из себя одну строчку из внешнего ip.

    ![](pics/03.7.png)

6) В Ubuntu 20.04 для настройки сети используется утилита netplan. Ее конфигурационный файл находится в директории /etc/netplan и имеет расширение ".yaml". Перед изменением кофигурационного файла следует сделать его бэкап. Далее с правами администратора вносим изменения в любом текстовом редакторе.

    Я прописала адрес (addresses:), шлюз (gateway4:) и сервера днс (nameservers: addresses:).

    ![](pics/03.8.png)
    
    Чтобы зафиксировать изменения, нужно выполнить команду sudo netplan apply. Перед этим можно сделать проверку с помощью sudo netplan try.

    ![](pics/03.9.png)

7) Перезагружаем виртуальную машину командой reboot и проверяем, сохранился ли конфиг.

    ![](pics/03.10.png)

    Проверяем, что изменения отобразились в выводах команды ip. Видим, что теперь адрес шлюза задан статически, а не получен от dhcp-сервера. Также видим измененный ip-адрес.

    ![](pics/03.11.png)

    Посмотреть на используемые dns-серверы можно командой systemd-resolve --status.

    ![](pics/03.14.png)

    Успешно пингуем ya.ru и 1.1.1.1 с помощью команды ping.

    ![](pics/03.12.png)

    ![](pics/03.13.png)

---
## Part 4. Обновление ОС

Команда для синхронизации индекса пакетов из репозиториев:

    sudo apt-get update

![](pics/04.1.png)

Команда для установки самых новых версий пакетов:

    sudo apt-get upgrade

![](pics/04.2.png)

После установки введем sudo apt-get upgrade еще раз и увидим, что пакетов, подлежащих обновлению, не осталось.

![](pics/04.3.png)

---
## Part 5. Использование команды sudo

Чтобы разрешить пользователю выполнять команду sudo, нужно добавить его в группу sudo. Для этого от имени администратора выполним команду usermod с опциями -a (--append, добавляет пользователя в дополнительные группы) и -G (--groups, список дополнительных групп).

![](pics/05.1.png)

Команда sudo предоставляет возможность пользователям выполнять команды от имени суперпользователя root.

> Root или суперпользователь — это специальный аккаунт и группа пользователей в UNIX-подобных системах с идентификатором пользователя UID 0, владелец которого имеет право на выполнение всех без исключения операций.

Чтобы сменить пользователя, нужно ввести команду su - <имя пользователя>. Перед этим мне понадобилось установить пароль для созданного в Part 2 пользователя с помощью команды sudo passwd <имя пользователя>.

![](pics/05.2.png)

Сменив пользователя, редактируем /etc/hostname.

![](pics/05.3.png)

![](pics/05.4.png)

Перезапускаем виртуальную машину и видим внесенные изменения.

![](pics/05.5.png)

---
## Part 6. Установка и настройка службы времени

Чтобы включить автоматическую синхронизацию времени, нужно ввести команду sudo timedatectl set-ntp on.

![](pics/06.2.png)

![](pics/06.1.png)


## Part 7. Установка и использование текстовых редакторов

---
**VIM**

---

1. Редактирование + сохранение

    Нажать a для включения режима вставки, вписать никнейм, нажать Esc для выхода из режима вставки, ввести :wq

    ![](pics/07.1.png)

2. Выход без сохранения

    Для выхода без сохранения ввести :q!

    ![](pics/07.2.png)

    ![](pics/07.3.png)


3. Поиск и замена

    Для поиска нажать / и ввести искомое слово, затем нажать Enter. n - перейти к следующему вхождению искомой строки. Команда замены: :[количество обрабатываемых строк]s/{заменяемое}/{заменитель}/[флаги] [количество замен]. Чтобы заменить все 21 на 42, я ввела :s/21/42/g

    ![](pics/07.4.png)

    ![](pics/07.5.png)

---
**NANO**

---
1. Редактирование + сохранение

    Просто начать вводить текст. Для выхода нажать Ctrl+X, подтвердить сохранение с помощью Y

    ![](pics/07.6.png)

2. Выход без сохранения

    Для выхода без сохранения нажать Ctrl+X, затем N

    ![](pics/07.7.png)

    ![](pics/07.8.png)

3. Поиск и замена

    Для поиска нажать Ctrl+W, Enter. Для замены вписать в режиме поиска заменяемое слово, нажать Ctrl+R, вписать слово-замену и нажать Enter. На каждом вхождении искомого слова nano будет спрашивать, заменять ли его. Y - да, N - нет, A - заменить сразу все

    ![](pics/07.9.png)

    ![](pics/07.10.png)

    ![](pics/07.11.png)

---
**JOE**

---
1. Редактирование + сохранение

    Просто начать вводить текст. Для выхода - Ctrl+K+Q, далее Y, чтобы сохранить

    ![](pics/07.12.png)

2. Выход без сохранения

    Для выхода - Ctrl+K+Q, далее N, чтобы отменить изменения

    ![](pics/07.13.png)

    ![](pics/07.14.png)

3. Поиск и замена

    Для поиска нужно нажать Ctrl+K+F, ввести искомую строку и нажать Enter два раза. Поиск начнется с места, на котором находится курсор. Для замены нажать Ctrl+K+F, Enter, затем R, ввести слово-замену и нажать Enter. По аналогии с nano, joe будет спрашивать, менять ли каждое вхождение искомой строки. Y - да, N - нет, R - заменить сразу все. Замена начинается с места, на котором находится курсор

    ![](pics/07.15.png)

    ![](pics/07.16.png)

    ![](pics/07.17.png)

## Part 8. Установка и базовая настройка сервиса SSHD

Команды для установки SSH и добавления его в автозагрузку:

    sudo apt install openssh-server
    sudo systemctl enable ssh

![](pics/08.1.png)

Порт по умолчанию - 22. Для того, чтобы его изменить, нужно отредактировать файл /etc/ssh/sshd_config, указав нужный номер напротив слова Port. По умолчанию строки записаны в виде комментариев, с символом #. Его нужно удалить.

![](pics/08.2.png)

> ps (от англ. process status) — программа в Unix-подобных операционных системах, выводящая отчёт о работающих процессах. Ключ -А (-е) позволяет вывести все процессы.

Чтобы не искать процесс sshd вручную, можно также воспользоваться grep.

![](pics/08.3.png)

Перезапускаем систему с помощью команды reboot.
Для использования команды netstat понадобилось установить net-tools (sudo apt install net-tools).

![](pics/08.4.png)

> netstat (network statistics) — утилита командной строки, выводящая на дисплей состояние TCP-соединений (как входящих, так и исходящих), таблицы маршрутизации, число сетевых интерфейсов и сетевую статистику по протоколам. Основное назначение утилиты — поиск сетевых проблем и определение производительности сети.

**Используемые в задании ключи:**

- -t (--tcp) - показывать только TCP порты.
- -a (--all) - показывать состояние всех сокетов.
- -n (--numeric) - показывать сетевые адреса как числа (например 127.0.0.53:53 вместо localhost:domain)

    > Сокет (англ. socket — разъём) — название программного интерфейса для обеспечения обмена данными между процессами. Для взаимодействия между машинами с помощью стека протоколов TCP/IP используются адреса и порты. Адрес представляет собой 32-битную структуру для протокола IPv4, 128-битную для IPv6. Номер порта — целое число в диапазоне от 0 до 65535 (для протокола TCP). Эта пара определяет сокет («гнездо», соответствующее адресу и порту). В процессе обмена, как правило, используется два сокета — сокет отправителя и сокет получателя.

**Значения столбцов:**
- ***Proto*** -	протокол, используемый сокетом. Так как была использована опция [-t|--tcp], в выводе пристутвуют только TCP-сокеты.
- ***Recv-Q*** - счётчик байт, не скопированных программой пользователя из этого сокета.
- ***Send-Q*** - счётчик байтов, не подтверждённых удалённым узлом.
- ***Local Address*** - адрес и номер порта локального конца сокета. Если указана опция [-n|--numeric], вывод в формате [адрес сокета:номер порта], иначе - [каноническое имя узла:соответствующее имя службы]. В интересующей нас строчке 0.0.0.0 - адрес локального конца сокета, 2022 - номер порта, который мы поменяли с 22 на 2022. Адрес 0.0.0.0 означает, что удаленный конец сокета будет доступен всем локальным ip-адресам.
- ***Foreign Address*** - адрес и номер порта удалённого конца сокета.
- ***State*** - состояние сокета. Состояние LISTEN означает, что сокет ожидает входящих подключений.

---
## Part 9. Установка и использование утилит top, htop

Информация о состоянии системы из вывода утилиты top (Table Of Processes):

![](pics/09.1.png)

- **uptime (как долго работает система)** - 1 час 13 минут
- **количество авторизированных пользователей** - 1
- **общая загрузка системы** - 0.00 (система в состоянии простоя)
- **общее количество процессов** - 94
- **загрузка cpu** - 0.3% процессорного времени было направлено на процессы ядра, 99.7% времени процессор был в состоянии покоя
- **загрузка памяти** - всего есть 976.9 мебибайт оперативной памяти (1 мебибайт = 2^20 байт, 976.9 мебибайт ≈ 1 гигабайт): из них 144.7 занято, 371.8 свободно, 460.4 занимает кэш системы.
- **PID процесса, занимающего больше всего памяти** - 645

    ![](pics/09.2.png)

- **PID процесса, занимающего больше всего процессорного времени** - 1413

    ![](pics/09.3.png)

Работа с утилитой htop:

- Сортировка(F3):
    - по PID:

        ![](pics/09.4.1.png)

    - по PERCENT_CPU:

        ![](pics/09.4.2.png)

    - по PERCENT_MEM:

        ![](pics/09.4.3.png)

    - по TIME:

        ![](pics/09.4.4.png)

- Фильтрация (F4) для процесса sshd:

    ![](pics/09.5.png)

- Поиск (F3) процесса syslog:

    ![](pics/09.6.png)

- С выводом hostname, clock и uptime (настройка вывода F2):

    ![](pics/09.7.png)

---
## Part 10. Использование утилиты fdisk

    sudo fdisk -l > diskinfo.txt; nano diskinfo.txt

![](pics/10.2.png)

В выводе пристутствует пять разделов /dev/loop* и один /dev/mapper/ubuntu* - они созданы ядром. Нас интересует /dev/sda - информация о жестком диске в целом.

**Имя:** /dev/sda

**Размер:** 10 гибибайт

**Количество секторов:** 20971520

**Размер swap:** 1515 мебибайт

---
## Part 11. Использование утилиты df

Корневой раздел (/):
- Информация из команды df:

    ![](pics/11.1.png)
    
    - **размер раздела** - 7959736
    - **размер занятого пространства** - 4126848
    - **размер свободного пространства** - 3832888
    - **процент использования** - 52%

    Используемая единица измерения - килобайты.

- Информация из команды df -Th:

    ![](pics/11.2.png)

    - **размер раздела** - 8.1 Гб
    - **размер занятого пространства** - 4.0 Гб
    - **размер свободного пространства** - 3.7 Гб
    - **процент использования** - 52%

    Тип файловой системы - ext4.

---
## Part 12. Использование утилиты du

Вывод du для /home, /var, /var/log сначала в байтах, затем в человекочитаемом виде.

![](pics/12.1.png)

Размер всего содержимого в /var/log.

![](pics/12.2.png)

---
## Part 13. Установка и использование утилиты ncdu

    sudo apt install ncdu
    sudo ncdu /

Для навигации среди списка директорий используются стрелки, Enter для выбора.

![](pics/13.1.png)

![](pics/13.2.png)

Сравнение вывода du и ncdu:

|            | du          | ncdu       |
| :---       |    :----:   |       ---: |
| /home      | 112 КiB     | 112 KiB    |
| /var       | 595 МiB     | 669.1 MiB  |
| /var/log   | 75 МiB      | 74.8 Mib   |


---
## Part 14. Работа с системными журналами

***/var/log/dmesg*** содержит информацию о драйверах устройств.

![](pics/14.1.png)

***/var/log/syslog*** содержит глобальный системный журнал, в котором пишутся сообщения от ядра Linux, различных служб, сетевых интерфейсов и т.д. с момента запуска системы.

![](pics/14.2.png)

***/var/log/auth.log***  — информация об авторизации пользователей, включая удачные и неудачные попытки входа в систему, а также задействованные механизмы аутентификации.

![](pics/14.3.png)

Информация об авторизации:

    sudo cat /var/log/auth.log | grep login

![](pics/14.4.png)

Мы видим, что последняя успешная авторизация была выполнена 26 октября в 17:35:02 пользователем weaveryu. Метод входа называется LOGIN.

Перезапуск ssh:

    sudo systemctl restart sshd

Сообщения о перезапуске в /var/log/syslog:

![](pics/14.5.png)

---
## Part 15. Использование планировщика заданий CRON

Команда для редактирования конфигурационного файла cron активного пользователя:
    
    crontab -e

Посмотреть этот файл: 

    crontab -l

![](pics/15.1.png)

Записи в /var/log/syslog:

![](pics/15.2.png)

Удаление конфигурационного файла:

    crontab -r

Попытка вывести список задач после удаления:

![](pics/15.3.png)
